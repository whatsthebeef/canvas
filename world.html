<?xml version="1.0"?>
<html>
<head>
<script src="js/jquery-1.7.1.js"> </script>
<script src="js/Array+manipulations.js"> </script>
<script src="js/processing-1.3.6.js"> </script>
<script src="js/world.js"> </script>
<script src="js/world-editor.js"> </script>
<script src="js/jquery.dataTables.min.js"> </script>
<script>
    $(document).ready(function(){
        var canvas = $("#canvas")[0];
        var sketch = new Processing.Sketch(sketchProc);
        var processingInstance = new Processing(canvas, sketch);

        var world = new WORLD(); 

        world.setShapes({
            head : head(300, 100, 0, 20),
            body : body(300, 140, 0, 40, 40, 20, 80),
            legs : legs(300, 180, 0, 105),
            world : spinningSphere(300, 400, 0, 200, 255)
        });

        var editor = new WORLD_EDITOR(processingInstance, $); 
        editor.setWorld(world);
        editor.initMouse();
        editor.draw();

        // setInterval(function(){WORLD.draw(processingInstance);}, 1000);

        var sizeIncrementInput = $("#size_increment");
        var sizeDecrementInput = $("#size_decrement");
        var sizeInput = $("#size");
        var xposInput = $("#xpos");
        var yposInput = $("#ypos");
        var zposInput = $("#zpos");
        var colorInput = $("#color");

        var vxposInput = $("#vxpos");
        var vyposInput = $("#vypos");
        var vzposInput = $("#vzpos");

        var currentSelection = function(){
            return editor.currentSelection();
        }

        var updateInputs = function(){
            var cs = currentSelection();
            sizeInput.val(5);
            xposInput.val(cs.position.xpos);
            yposInput.val(cs.position.ypos);
            zposInput.val(cs.position.zpos);
            if(cs.originalColor){
                colorInput.val(cs.originalColor.toString(16));
            }
            if(cs instanceof VertexShape){
                var cv = cs.selectedVertex;
                vxposInput.val(cv.xpos);
                vyposInput.val(cv.ypos);
                vzposInput.val(cv.zpos);
            }
            world.draw(processingInstance);
        }

        $(document).bind("shapeselected", updateInputs);

        sizeIncrementInput.bind("click", function(){
            currentSelection().resize(100 + parseInt(sizeInput.val()));
            world.draw(processingInstance);
                });

        sizeDecrementInput.bind("click", function(){
            currentSelection().resize(100 - parseInt(sizeInput.val()));
            world.draw(processingInstance);
            });

        function attachTextListener(input, func) {
            input.bind("change keydown keyup", function(){
                if(currentSelection){
                    func(input.val());
                    world.draw(processingInstance);
                }
            });
        }

        attachTextListener(xposInput, function() {
            currentSelection().setXPosition(xposInput.val());
        });
        attachTextListener(yposInput, function() {
            currentSelection().setYPosition(yposInput.val());
        });
        attachTextListener(zposInput, function() {
            currentSelection().setZPosition(zposInput.val());
        });
        attachTextListener(vxposInput, function() {
            currentSelection().setSelectedVertexXPos(vxposInput.val());
        });
        attachTextListener(vyposInput, function() {
            currentSelection().setSelectedVertexYPos(vyposInput.val());
        });
        attachTextListener(vzposInput, function() {
            currentSelection().setSelectedVertexZPos(vzposInput.val());
        });
        attachTextListener(colorInput, function() {
            currentSelection().originalColor = parseInt(colorInput.val(), 16);
        });

        var registry = $("#registry").dataTable({
                "aaData" : editor.objectRegistry().tableStructure(),
                "aoColumns" : [{"sTitle":"id"},{"sTitle":"name"},{"sTitle":"color"}],
                "bPaginate": false,
                "bLengthChange": true,
                "bFilter": false,
                "bSort": false,
                "bInfo": false,
                "bAutoWidth": false
                });

         /* Add events */
        $("#registry tbody tr").live("click", function () {
            var sTitle;
            var nTds = $('td', this);
            var sBrowser = $(nTds[1]).text();
            var sGrade = $(nTds[4]).text();
        } );

        $("#registry tbody tr").click( function( e ) {
            var nTds = $('td', this);
            if ( $(this).hasClass('row_selected') ) {
                $(this).removeClass('row_selected');
            }
            else {
                registry.$('tr.row_selected').removeClass('row_selected');
                $(this).addClass('row_selected');
                editor.selectByID(parseInt($(nTds[0]).text()));
            }
        });
    });
</script>
<link href="css/world.css" type="text/css" rel="stylesheet"></link>
<link href="css/jquery.dataTables.css" type="text/css" rel="stylesheet"></link>
</head>
<body>
    <canvas id="canvas"> </canvas>
    <div id="controls">
        <div class="control">
            <label for="size">Size</label>
            <div class="button" id="size_increment"><div class="inner_button">+</div></div>
            <div class="button minus" id="size_decrement"><div class="inner_button minus">-</div></div>
            <input type="text" name="size" id="size" placeholder="Increment by"></input>
        </div>
        <div class="control">
            <label for="xpos">Position</label>
            <input class="coords" type="text" name="xpos" id="xpos" placeholder="x pos"></input>
            <input class="coords" type="text" name="ypos" id="ypos" placeholder="y pos"></input>
            <input class="coords" type="text" name="zpos" id="zpos" placeholder="z pos"></input>
        </div>
        <div class="control">
            <label for="color">Color</label>
            <input type="text" name="color" id="color" placeholder="In hex scale"></input>
        </div>
        <div class="control">
            <label for="xpos">Vertex Position</label>
            <input class="coords" type="text" name="xpos" id="vxpos" placeholder="x pos"></input>
            <input class="coords" type="text" name="ypos" id="vypos" placeholder="y pos"></input>
            <input class="coords" type="text" name="zpos" id="vzpos" placeholder="z pos"></input>
        </div>
        <div id="register">
            <table id="registry"></table>
        </div>
   </div>
  
</body>
</html>
